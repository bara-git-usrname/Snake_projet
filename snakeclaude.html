<!DOCTYPE html>
<html>
<head>
  <title>Snake Game - Levels & Leaderboard</title>
  <meta charset="UTF-8">
  <style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: 'Courier New', monospace;
  }

  body {
    background: #0a0a0a;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
  }

  /* Container for all views */
  #container {
    text-align: center;
  }

  /* Hide views by default - we'll show them as needed */
  .view {
    display: none;
  }

  .view.active {
    display: block;
  }

  /* Menu styling */
  #menu {
    padding: 20px;
  }

  h1 {
    color: #4ade80;
    font-size: 48px;
    margin-bottom: 30px;
    text-shadow: 0 0 10px #4ade80;
  }

  button {
    background: #4ade80;
    color: black;
    border: none;
    padding: 15px 30px;
    margin: 10px;
    font-size: 18px;
    font-family: 'Courier New', monospace;
    cursor: pointer;
    border-radius: 5px;
    transition: all 0.3s;
  }

  button:hover {
    background: #22c55e;
    transform: scale(1.05);
  }

  /* Level selection grid */
  .level-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    max-width: 500px;
    margin: 20px auto;
  }

  .level-button {
    padding: 30px;
    font-size: 16px;
  }

  /* Game canvas */
  canvas {
    border: 2px solid #4ade80;
    box-shadow: 0 0 20px rgba(74, 222, 128, 0.3);
  }

  /* Score display */
  #scoreDisplay {
    font-size: 24px;
    margin: 15px;
    color: #4ade80;
  }

  /* Leaderboard styling */
  #leaderboard table {
    margin: 20px auto;
    border-collapse: collapse;
    min-width: 400px;
  }

  #leaderboard th {
    background: #4ade80;
    color: black;
    padding: 12px;
    font-size: 18px;
  }

  #leaderboard td {
    padding: 10px;
    border-bottom: 1px solid #333;
    font-size: 16px;
  }

  #leaderboard tr:nth-child(even) {
    background: #1a1a1a;
  }

  /* Game over message */
  #gameOverMsg {
    display: none;
    margin: 20px;
    font-size: 24px;
    color: #ff6b6b;
  }

  .back-button {
    background: #666;
    margin-top: 20px;
  }

  .back-button:hover {
    background: #888;
  }
  </style>
</head>
<body>
<div id="container">
  
  <!-- MAIN MENU VIEW -->
  <div id="menu" class="view active">
    <h1>üêç SNAKE GAME</h1>
    <button onclick="showLevelSelect()">PLAY GAME</button>
    <button onclick="showLeaderboard()">LEADERBOARD</button>
  </div>

  <!-- LEVEL SELECT VIEW -->
  <div id="levelSelect" class="view">
    <h1>SELECT LEVEL</h1>
    <div class="level-grid">
      <button class="level-button" onclick="startGame(1)">
        LEVEL 1<br>Classic
      </button>
      <button class="level-button" onclick="startGame(2)">
        LEVEL 2<br>Walls
      </button>
      <button class="level-button" onclick="startGame(3)">
        LEVEL 3<br>Maze
      </button>
      <button class="level-button" onclick="startGame(4)">
        LEVEL 4<br>Challenge
      </button>
    </div>
    <button class="back-button" onclick="showMenu()">BACK TO MENU</button>
  </div>

  <!-- GAME VIEW -->
  <div id="game" class="view">
    <div id="scoreDisplay">Score: 0 | Level: 1</div>
    <canvas width="400" height="400" id="gameCanvas"></canvas>
    <div id="gameOverMsg"></div>
    <button class="back-button" onclick="endGame()">QUIT TO MENU</button>
  </div>

  <!-- LEADERBOARD VIEW -->
  <div id="leaderboard" class="view">
    <h1>üèÜ LEADERBOARD</h1>
    <table>
      <thead>
        <tr>
          <th>Rank</th>
          <th>Name</th>
          <th>Score</th>
          <th>Level</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody">
        <!-- Populated by JavaScript -->
      </tbody>
    </table>
    <button class="back-button" onclick="showMenu()">BACK TO MENU</button>
  </div>

</div>

<script>
// ==========================================
// GAME STATE & CONFIGURATION
// ==========================================

var canvas = document.getElementById('gameCanvas');
var context = canvas.getContext('2d');
var grid = 16;
var count = 0;
var gameRunning = false;
var currentLevel = 1;
var score = 0;

// Snake object
var snake = {
  x: 160,
  y: 160,
  dx: grid,
  dy: 0,
  cells: [],
  maxCells: 4
};

// Apple object
var apple = {
  x: 320,
  y: 320
};

// Obstacles array - different for each level
var obstacles = [];

// ==========================================
// LEVEL DEFINITIONS
// ==========================================
// Each level has a unique obstacle layout

function getLevelObstacles(level) {
  var obs = [];
  
  if (level === 1) {
    // Level 1: No obstacles (classic snake)
    obs = [];
  }
  else if (level === 2) {
    // Level 2: Border walls
    // Top wall
    for (var i = 3; i < 22; i++) {
      obs.push({x: i * grid, y: 3 * grid});
    }
    // Bottom wall
    for (var i = 3; i < 22; i++) {
      obs.push({x: i * grid, y: 21 * grid});
    }
    // Left wall
    for (var i = 3; i < 22; i++) {
      obs.push({x: 3 * grid, y: i * grid});
    }
    // Right wall
    for (var i = 3; i < 22; i++) {
      obs.push({x: 21 * grid, y: i * grid});
    }
  }
  else if (level === 3) {
    // Level 3: Maze pattern
    // Vertical walls
    for (var i = 5; i < 15; i++) {
      obs.push({x: 8 * grid, y: i * grid});
      obs.push({x: 16 * grid, y: i * grid});
    }
    // Horizontal walls
    for (var i = 8; i < 17; i++) {
      obs.push({x: i * grid, y: 10 * grid});
    }
  }
  else if (level === 4) {
    // Level 4: Complex challenge
    // Cross pattern in center
    for (var i = 8; i < 17; i++) {
      obs.push({x: 12 * grid, y: i * grid});
      obs.push({x: i * grid, y: 12 * grid});
    }
    // Corner blocks
    for (var i = 0; i < 3; i++) {
      for (var j = 0; j < 3; j++) {
        obs.push({x: i * grid, y: j * grid});
        obs.push({x: (24 - i) * grid, y: j * grid});
        obs.push({x: i * grid, y: (24 - j) * grid});
        obs.push({x: (24 - i) * grid, y: (24 - j) * grid});
      }
    }
  }
  
  return obs;
}

// ==========================================
// VIEW MANAGEMENT
// ==========================================
// Functions to switch between different screens

function showView(viewId) {
  // Hide all views
  var views = document.getElementsByClassName('view');
  for (var i = 0; i < views.length; i++) {
    views[i].classList.remove('active');
  }
  // Show the requested view
  document.getElementById(viewId).classList.add('active');
}

function showMenu() {
  showView('menu');
  gameRunning = false;
}

function showLevelSelect() {
  showView('levelSelect');
}

function showLeaderboard() {
  showView('leaderboard');
  displayLeaderboard();
}

// ==========================================
// GAME CONTROL FUNCTIONS
// ==========================================

function startGame(level) {
  currentLevel = level;
  score = 0;
  
  // Reset snake
  snake.x = 32;
  snake.y = 32;
  snake.cells = [];
  snake.maxCells = 4;
  snake.dx = grid;
  snake.dy = 0;
  
  // Set obstacles for this level
  obstacles = getLevelObstacles(level);
  
  // Place apple in a safe location
  placeApple();
  
  // Reset game over message
  document.getElementById('gameOverMsg').style.display = 'none';
  
  // Update score display
  updateScoreDisplay();
  
  // Show game view and start game loop
  showView('game');
  gameRunning = true;
  requestAnimationFrame(loop);
}

function endGame() {
  gameRunning = false;
  showMenu();
}

function gameOver() {
  gameRunning = false;
  
  // Show game over message
  var msg = document.getElementById('gameOverMsg');
  msg.textContent = 'üíÄ GAME OVER! Final Score: ' + score;
  msg.style.display = 'block';
  
  // Prompt for name and save to leaderboard
  setTimeout(function() {
    var playerName = prompt('Enter your name for the leaderboard:', 'Player');
    if (playerName) {
      saveScore(playerName, score, currentLevel);
    }
  }, 500);
}

// ==========================================
// UTILITY FUNCTIONS
// ==========================================

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}

function updateScoreDisplay() {
  document.getElementById('scoreDisplay').textContent = 
    'Score: ' + score + ' | Level: ' + currentLevel;
}

// Place apple in a location that's not occupied by snake or obstacles
function placeApple() {
  var validPosition = false;
  
  while (!validPosition) {
    apple.x = getRandomInt(0, 25) * grid;
    apple.y = getRandomInt(0, 25) * grid;
    
    validPosition = true;
    
    // Check if apple is on an obstacle
    for (var i = 0; i < obstacles.length; i++) {
      if (apple.x === obstacles[i].x && apple.y === obstacles[i].y) {
        validPosition = false;
        break;
      }
    }
    
    // Check if apple is on snake
    for (var i = 0; i < snake.cells.length; i++) {
      if (apple.x === snake.cells[i].x && apple.y === snake.cells[i].y) {
        validPosition = false;
        break;
      }
    }
  }
}

// Check if position collides with obstacles
function checkObstacleCollision(x, y) {
  for (var i = 0; i < obstacles.length; i++) {
    if (x === obstacles[i].x && y === obstacles[i].y) {
      return true;
    }
  }
  return false;
}

// ==========================================
// MAIN GAME LOOP
// ==========================================

function loop() {
  if (!gameRunning) return;
  
  requestAnimationFrame(loop);

  // Slow game loop to 15 fps
  if (++count < 4) {
    return;
  }

  count = 0;
  context.clearRect(0, 0, canvas.width, canvas.height);

  // Move snake by its velocity
  snake.x += snake.dx;
  snake.y += snake.dy;

  // Wrap snake position on screen edges
  if (snake.x < 0) {
    snake.x = canvas.width - grid;
  }
  else if (snake.x >= canvas.width) {
    snake.x = 0;
  }

  if (snake.y < 0) {
    snake.y = canvas.height - grid;
  }
  else if (snake.y >= canvas.height) {
    snake.y = 0;
  }

  // Check if snake hits obstacle
  if (checkObstacleCollision(snake.x, snake.y)) {
    gameOver();
    return;
  }

  // Keep track of snake body
  snake.cells.unshift({x: snake.x, y: snake.y});

  // Remove tail cells beyond max length
  if (snake.cells.length > snake.maxCells) {
    snake.cells.pop();
  }

  // Draw obstacles
  context.fillStyle = '#ff6b6b';
  for (var i = 0; i < obstacles.length; i++) {
    context.fillRect(obstacles[i].x, obstacles[i].y, grid - 1, grid - 1);
  }

  // Draw apple
  context.fillStyle = 'red';
  context.fillRect(apple.x, apple.y, grid - 1, grid - 1);

  // Draw snake
  context.fillStyle = '#4ade80';
  snake.cells.forEach(function(cell, index) {
    // Head is brighter
    if (index === 0) {
      context.fillStyle = '#22c55e';
    } else {
      context.fillStyle = '#4ade80';
    }
    
    context.fillRect(cell.x, cell.y, grid - 1, grid - 1);

    // Check if snake ate apple
    if (cell.x === apple.x && cell.y === apple.y) {
      snake.maxCells++;
      score += 10; // Increase score
      updateScoreDisplay();
      placeApple(); // Place new apple
    }

    // Check collision with own body
    for (var i = index + 1; i < snake.cells.length; i++) {
      if (cell.x === snake.cells[i].x && cell.y === snake.cells[i].y) {
        gameOver();
        return;
      }
    }
  });
}

// ==========================================
// KEYBOARD CONTROLS
// ==========================================

document.addEventListener('keydown', function(e) {
  if (!gameRunning) return;
  
  // Prevent snake from reversing into itself
  
  // Left arrow
  if (e.which === 37 && snake.dx === 0) {
    snake.dx = -grid;
    snake.dy = 0;
  }
  // Up arrow
  else if (e.which === 38 && snake.dy === 0) {
    snake.dy = -grid;
    snake.dx = 0;
  }
  // Right arrow
  else if (e.which === 39 && snake.dx === 0) {
    snake.dx = grid;
    snake.dy = 0;
  }
  // Down arrow
  else if (e.which === 40 && snake.dy === 0) {
    snake.dy = grid;
    snake.dx = 0;
  }
});

// ==========================================
// LEADERBOARD FUNCTIONS (localStorage)
// ==========================================

function saveScore(name, score, level) {
  // Get existing leaderboard from localStorage
  var leaderboard = JSON.parse(localStorage.getItem('snakeLeaderboard')) || [];
  
  // Add new score
  leaderboard.push({
    name: name,
    score: score,
    level: level,
    date: new Date().toISOString()
  });
  
  // Sort by score (highest first)
  leaderboard.sort(function(a, b) {
    return b.score - a.score;
  });
  
  // Keep only top 10 scores
  leaderboard = leaderboard.slice(0, 10);
  
  // Save back to localStorage
  localStorage.setItem('snakeLeaderboard', JSON.stringify(leaderboard));
}

function displayLeaderboard() {
  var leaderboard = JSON.parse(localStorage.getItem('snakeLeaderboard')) || [];
  var tbody = document.getElementById('leaderboardBody');
  
  // Clear existing rows
  tbody.innerHTML = '';
  
  if (leaderboard.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4">No scores yet. Play a game!</td></tr>';
    return;
  }
  
  // Create a row for each score
  leaderboard.forEach(function(entry, index) {
    var row = document.createElement('tr');
    row.innerHTML = 
      '<td>' + (index + 1) + '</td>' +
      '<td>' + entry.name + '</td>' +
      '<td>' + entry.score + '</td>' +
      '<td>' + entry.level + '</td>';
    tbody.appendChild(row);
  });
}

</script>
</body>
</html>